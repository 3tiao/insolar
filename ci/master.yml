groups:
- name: master
  jobs:
    - insolard
    - builder

resources:
- name: master
  type: git
  source:
    uri: https://github.com/insolar/insolar.git
    branch: master

- name: insolard
  type: docker-image
  source:
    repository: registry.ins.world/insolard
    username: ((meta.registry.username))
    password: ((meta.registry.password))

- name: builder
  type: docker-image
  source:
    repository: registry.ins.world/builder
    username: ((meta.registry.username))
    password: ((meta.registry.password))

jobs:
- name: insolard
  public: true
  plan:
  - get: master
    trigger: true
  - get: builder
    params: 
      save: true
  - put: insolard
    params:
      build: master
      target: insolard
      load_base: builder

- name: builder
  public: true
  plan:
  - get: master
    trigger: false
  - put: builder
    params:
      build: master
      dockerfile: master/docker/Dockerfile.builder
